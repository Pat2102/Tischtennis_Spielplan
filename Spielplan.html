<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tischtennis Team-Losung v3.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        input, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 80%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .admin-only {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Tischtennis-Team-Lösung</h1>

    <!-- Benutzerbereich -->
    <div id="userSection">
        <h2>Spieler hinzufügen</h2>
        <input type="text" id="playerName" placeholder="Spielername">
        <button onclick="addPlayer()">Hinzufügen</button>
        <h3>Spielerliste:</h3>
        <ul id="playerList"></ul>
        <button onclick="drawTeams()">Teams losen</button>
        <h3>Teams:</h3>
        <table id="teamTable">
            <thead>
                <tr>
                    <th>Team</th>
                    <th>Spieler 1</th>
                    <th>Spieler 2</th>
                    <th>Teamname</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <h3>Modus wählen:</h3>
        <div>
            <label>
                <input type="radio" name="mode" value="roundRobin" checked> Jeder gegen Jeden
            </label>
            <label>
                <input type="radio" name="mode" value="groupPhase"> Gruppenphase
            </label>
        </div>
        <button onclick="generate()">Spielplan/Gruppen erstellen</button>
        <div id="outputContainer" class="hidden">
            <h3 id="outputTitle"></h3>
            <div id="outputContent"></div>
        </div>
    </div>

    <!-- Adminbereich (geschützt) -->
    <div id="adminSection" class="admin-only">
        <h2>Admin Bereich</h2>
        <h3>Spielplan:</h3>
        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>Spiel</th>
                    <th>Team 1</th>
                    <th>Team 2</th>
                    <th>Ergebnis</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <h3>Zwischenstand:</h3>
        <table id="standingsTable">
            <thead>
                <tr>
                    <th>Platz</th>
                    <th>Team</th>
                    <th>Punkte</th>
                    <th>Spiele</th>
                    <th>+/-</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <h3>Team-Mitglieder:</h3>
        <table id="teamsTable">
            <thead>
                <tr>
                    <th>Team</th>
                    <th>Mitglied 1</th>
                    <th>Mitglied 2</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Login für Admin -->
    <div id="loginSection">
        <h2>Admin Login</h2>
        <input type="password" id="adminPassword" placeholder="Passwort">
        <button onclick="login()">Login</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAksVQRYriHb9gS7TjgeN3faX10IoKJBIw",
            authDomain: "tischtennis-9575d.firebaseapp.com",
            databaseURL: "https://tischtennis-9575d-default-rtdb.firebaseio.com",
            projectId: "tischtennis-9575d",
            storageBucket: "tischtennis-9575d.appspot.com",
            messagingSenderId: "164931288159",
            appId: "1:164931288159:web:5863d07a4cf511ee462fea"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const players = [];
        let teams = [];
        let schedule = [];

        // Spieler hinzufügen
        function addPlayer() {
            const playerName = document.getElementById('playerName').value.trim();
            if (playerName && !players.includes(playerName)) {
                players.push(playerName);
                document.getElementById('playerList').innerHTML += `<li>${playerName}</li>`;
                document.getElementById('playerName').value = '';
                savePlayersToDatabase();
            } else {
                alert(playerName ? 'Spieler existiert bereits.' : 'Spielername ist leer.');
            }
        }

        // Spieler in Firebase speichern
        function savePlayersToDatabase() {
            const playersRef = ref(db, 'players');
            set(playersRef, players);
        }

        // Teams losen
        function drawTeams() {
            if (players.length % 2 !== 0) {
                alert('Bitte eine gerade Anzahl an Spielern hinzufügen.');
                return;
            }

            teams = [];
            while (players.length) {
                const player1 = players.pop();
                const player2 = players.pop();
                const teamName = `Team ${teams.length + 1}`;
                teams.push([player1, player2, teamName]);
            }
            displayTeams();
            saveTeamsToDatabase();
        }

        // Teams in Firebase speichern
        function saveTeamsToDatabase() {
            const teamsRef = ref(db, 'teams');
            set(teamsRef, teams);
        }

        // Teams anzeigen
        function displayTeams() {
            const teamTableBody = document.getElementById('teamTable').getElementsByTagName('tbody')[0];
            teamTableBody.innerHTML = '';
            teams.forEach((team, index) => {
                const row = teamTableBody.insertRow();
                row.insertCell(0).innerText = `Team ${index + 1}`;
                row.insertCell(1).innerText = team[0];
                row.insertCell(2).innerText = team[1];
                row.insertCell(3).innerText = team[2];
            });
        }

        // Login für Admin
        function login() {
            const password = document.getElementById('adminPassword').value;
            const correctPassword = "admin123";  // Beispiel: hartcodiertes Passwort
            if (password === correctPassword) {
                document.getElementById('adminSection').classList.remove('admin-only');
                document.getElementById('loginSection').classList.add('hidden');
            } else {
                alert('Falsches Passwort!');
            }
        }

        // Spielplan erstellen (Admin)
        function generate() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            if (mode === 'roundRobin') {
                generateRoundRobinSchedule();
            } else {
                generateGroupPhaseSchedule();
            }
        }

        // Spielplan (Rundenturnier) erstellen
        function generateRoundRobinSchedule() {
            schedule = [];
            for (let i = 0; i < teams.length; i++) {
                for (let j = i + 1; j < teams.length; j++) {
                    schedule.push({ team1: teams[i], team2: teams[j] });
                }
            }
            displaySchedule();
            saveScheduleToDatabase();
        }

        // Spielplan (Gruppenphase) erstellen
        function generateGroupPhaseSchedule() {
            // Hier kann eine Gruppenphasenerstellung basierend auf den Teams hinzugefügt werden
        }

        // Spielplan anzeigen
        function displaySchedule() {
            const scheduleTableBody = document.getElementById('scheduleTable').getElementsByTagName('tbody')[0];
            scheduleTableBody.innerHTML = '';
            schedule.forEach((match, index) => {
                const row = scheduleTableBody.insertRow();
                row.insertCell(0).innerText = index + 1;
                row.insertCell(1).innerText = match.team1[2];
                row.insertCell(2).innerText = match.team2[2];
                row.insertCell(3).innerText = '-';
            });
        }

        // Spielplan in Firebase speichern
        function saveScheduleToDatabase() {
            const scheduleRef = ref(db, 'schedule');
            set(scheduleRef, schedule);
        }

        // Ergebnisse und Zwischenstände anzeigen (für alle)
        function displayResults() {
            // Ergebnisse und Zwischenstände aus der Firebase-Datenbank holen und anzeigen
        }
    </script>
</body>
</html>
